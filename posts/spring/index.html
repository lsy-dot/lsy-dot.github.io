<!DOCTYPE html>
<html lang="en"><head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <style>
        :root {
            --accent-color: #FF4D4D;
        }
    </style>

    
    
    
    
    
    

    
    <title>Spring学习笔记</title>
    <meta name="description" content="关于Spring学习的一些笔记">
    <meta name="keywords" content='框架'>

    <meta property="og:url" content="https://lsy-dot.github.io/posts/spring/">
    <meta property="og:type" content="website">
    <meta property="og:title" content="Spring学习笔记">
    <meta property="og:description" content="关于Spring学习的一些笔记">
    <meta property="og:image" content="../../static/images/image-20220829182427839.png">

    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:title" content="Spring学习笔记">
    <meta name="twitter:description" content="关于Spring学习的一些笔记">
    <meta property="twitter:domain" content="https://lsy-dot.github.io/posts/spring/">
    <meta property="twitter:url" content="https://lsy-dot.github.io/posts/spring/">
    <meta name="twitter:image" content="../../static/images/image-20220829182427839.png">

    
    <link rel="canonical" href="https://lsy-dot.github.io/posts/spring/" />

    <link rel="stylesheet" type="text/css" href="https://lsy-dot.github.io//css/normalize.min.css" media="print" onload="this.media='all'">
    <link rel="stylesheet" type="text/css" href="https://lsy-dot.github.io//css/main.css">
    <link disabled id="dark-theme" rel="stylesheet" href="https://lsy-dot.github.io//css/dark.css">

    <script src="https://lsy-dot.github.io//js/svg-injector.min.js"></script>
    <script src="https://lsy-dot.github.io//js/feather-icons.min.js"></script>
    <script src="https://lsy-dot.github.io//js/main.js"></script>

    
    
</head>
<body>
        <script type="text/javascript">
            
            setThemeByUserPref();
        </script><header class="header">
    <nav class="header-nav">

        
        <div class="avatar">
            <a href="https://lsy-dot.github.io/">
                <img src="https://lsy-dot.github.io/images/8531713.jpg" alt="avatar" />
            </a>
        </div>
        

        <div class="nav-title">
            <a class="nav-brand" href="https://lsy-dot.github.io/">lsy-dot</a>
        </div>

        <div class="nav-links">
            
            <div class="nav-link">
                <a href="https://lsy-dot.github.io/posts/"> Posts </a>
            </div>
            
            <div class="nav-link">
                <a href="https://lsy-dot.github.io/tags/"> Tags </a>
            </div>
            
            <div class="nav-link">
                <a href="https://github.com"><span data-feather='github'></span>  </a>
            </div>
            

            <span class="nav-icons-divider"></span>
            <div class="nav-link dark-theme-toggle">
                <span id="dark-theme-toggle-screen-reader-target" class="sr-only"></span>
                <a>
                    <span id="theme-toggle-icon" data-feather="moon"></span>
                </a>
            </div>

            <div class="nav-link" id="hamburger-menu-toggle">
                <a>
                    <span data-feather="menu"></span>
                </a>
            </div>

            
            <ul class="nav-hamburger-list visibility-hidden">
                
                <li class="nav-item">
                    <a href="https://lsy-dot.github.io/posts/"> Posts </a>
                </li>
                
                <li class="nav-item">
                    <a href="https://lsy-dot.github.io/tags/"> Tags </a>
                </li>
                
                <li class="nav-item">
                    <a href="https://github.com"><span data-feather='github'></span>  </a>
                </li>
                
                <li class="nav-item dark-theme-toggle">
                    <span id="dark-theme-toggle-screen-reader-target" class="sr-only">theme</span>
                    <a>
                        <span id="theme-toggle-icon" data-feather="moon"></span>
                    </a>
                </li>
            </ul>

        </div>
    </nav>
</header>
<main id="content">
    <div class="post container">
    <div class="post-header-section">
        <h1>Spring学习笔记</h1>
        <small role="doc-subtitle">关于Spring学习的一些笔记</small>
        <p class="post-date">
            September 7, 2022
        </p>

        <ul class="post-tags">
        
            <li class="post-tag"><a href="https://lsy-dot.github.io/tags/%E6%A1%86%E6%9E%B6">框架</a></li>
        
        </ul>
    </div>

    <div class="post-content">
        <p>
            <h1 id="quote">quote</h1>
<p><strong>君子不立危墙之下</strong></p>
<h1 id="参考链接和资料">参考链接和资料</h1>
<ul>
<li><a href="https://blog.csdn.net/chuige2013/article/details/124080891">SpringBoot 配置文件加载优先级</a></li>
<li><a href="https://blog.csdn.net/J080624/article/details/80508606">SpringBoot - 配置文件加载位置与优先级</a></li>
<li>Spring实战（第4版）</li>
<li><a href="https://blog.csdn.net/weixin_43005654/article/details/109320902">Spring实现AOP的三大方式</a></li>
<li><a href="https://blueblue233.github.io/blog/a4fd15ac/">3.1 @Controller注解</a></li>
<li><a href="https://blog.csdn.net/Colton_Null/article/details/84592748">SpringBoot 对 controller 层捕获全局异常并处理的方法（@ControllerAdvice 和 @ExceptionHandler）</a></li>
<li><a href="https://www.bilibili.com/video/BV1NY411P7VX">B站目前讲的最透彻的SpringBoot自动配置，大厂面试必备知识点</a></li>
</ul>
<h1 id="spring基础知识">Spring基础知识</h1>
<h2 id="aop和ioc">AOP和IOC</h2>
<pre tabindex="0"><code class="language-a" data-lang="a">最重要的两个概念：IOC和AOP
IOC是一种思想，将创建对象的权力交给容器，
从而对程序进行解耦
AOP将系统中重复的代码进行封装（日志、权限管理），
解耦方便后续程序进行扩展
</code></pre><h2 id="spring-aop使用方式">Spring AOP使用方式</h2>
<pre tabindex="0"><code class="language-a" data-lang="a">1、注解
2、xml(使用Spring原生api[继承接口]，自定义切面类)
使用过程:
1、编写业务类
2、写切面类，可以自定义，或者继承使用Spring apy
3、编写切点表达式[指定要织入的类和方法，同时指定何时织入]
一些专业术语
Aspect(切面):通常是一个类，里面可以定义切入点和通知
Advice(通知):AOP在特定的切入点上执行的增强处理，有before(前置),after(后置),afterReturning(最终),afterThrowing(异常),around(环绕)
Pointcut(切入点):就是带有通知的连接点，在程序中主要体现为书写切入点表达式
Spring AOP和AspectJ的区别
Spring AOP 属于运行时增强（动态代理），而 AspectJ 是编译时增强（静态编译）。
Spring AOP 基于代理(Proxying)，而 AspectJ 基于字节码操作(Bytecode Manipulation)。
</code></pre><h2 id="spring的组件有哪些">Spring的组件有哪些？</h2>
<pre tabindex="0"><code class="language-a" data-lang="a">Spring core、context：核心容器
Spring AOP：面向切面的编程
Spring ORM：数据访问和集成
Spring web、MVC：web和远程调用
Spring test：测试
推荐阅读书籍：Spring实战（第4版）
</code></pre><h2 id="bean的生命周期">bean的生命周期</h2>
<pre tabindex="0"><code class="language-a" data-lang="a">bean的生存周期
简单版：实例化、属性注入、初始化、销毁
</code></pre><p><strong>bean的生存周期</strong>
<img src="/images/bean%E7%94%9F%E5%91%BD%E5%91%A8%E6%9C%9F.jpg" alt="Markdowm Image"></p>
<h2 id="循环依赖三级缓存">循环依赖（三级缓存）</h2>
<pre tabindex="0"><code class="language-a" data-lang="a">循环依赖解决办法：
三级缓存（
1、成熟对象，
2、半成品对象[为了性能]，
3、工厂[为了代理]）
</code></pre><h2 id="事务">事务</h2>
<pre tabindex="0"><code class="language-a" data-lang="a">事务隔离级别:read uncommitted,read committed,
repeatable read,searialize
事务传播行为：require,support,mandatory,require_new,,not_support,never,nested
事务传播行为：需要事务,有无就行,一定要有,一定要新,不需要事务,一定不要,嵌套
</code></pre><h2 id="spring中存在的设计模式">Spring中存在的设计模式</h2>
<pre tabindex="0"><code class="language-a" data-lang="a">工厂模式[beanfactory],
单例模式[bean默认单例],
代理模式[AOP],
委派模式[dispatcher servlet]
</code></pre><h2 id="interceptor和filter的区别">interceptor和filter的区别</h2>
<pre tabindex="0"><code class="language-a" data-lang="a">1、从外到内：tomcat-&gt;filter-&gt;servlet-&gt;interceptor-&gt;controller
2、filter拦截request、response，interceptor可以访问spring中的的资源
也即，filter是属于servlet，而interceptor是属于spring的
3、filter基于函数回调，interceptor基于反射生成动态代理对象。
</code></pre><h2 id="springboot">SpringBoot</h2>
<h3 id="springbootapplication哪几部分组成">@SpringBootApplication哪几部分组成</h3>
<pre tabindex="0"><code class="language-a" data-lang="a">@SpringBootApplication哪几部分组成
1、@SpringBootConfiguration：组合了 @Configuration 注解，实现配置文件的功能。
2、@EnableAutoConfiguration：打开自动配置的功能，也可以关闭某个自动配置的选项，如关闭数据源自动配置功能：             
@SpringBootApplication(exclude = { DataSourceAutoConfiguration.class })。
3、@ComponentScan：Spring组件扫描。
</code></pre><h3 id="自动配置原理todo">自动配置原理(todo)</h3>
<pre tabindex="0"><code class="language-a" data-lang="a">注解SpringBootApplication:
SpringBootConfiguration[开启配置文件功能],
EnableAutoConfiguration[自动配置],
ComponentScan[组件扫描]

简单版本（结合 java spi）
Spring Boot 应用程序启动
通过Spring factories 机制(Spring 内置)加载配置文件
	即通过Classloader去获取classpath中的配置文件 META-INF/spring.factories
筛选出所有的自动配置类
	在所有的配置文件META-INF/spring.factories中，筛选出
	以EnableAutoConfiguration 为key的配置值
将这些类注入到Spring IOC容器中

中等版本（结合注解）
SpringApplication.run(..)
注册源配置类（就是main函数在的那个类）
递归加载和处理所有的配置类
加载处理源配置类
	处理注解@ComponentScan
	处理直接@Import
		在类AutoConfigurationImportSelector中加载处理自动配置类
			通过Spring factories 机制(Spring 内置)加载配置文件
        	筛选出所有的自动配置类
        	根据注解@Conditional顾虑掉不必要的自动配置类
</code></pre><h3 id="springboot的配置文件优先级">SpringBoot的配置文件优先级？</h3>
<pre tabindex="0"><code class="language-a" data-lang="a">项目内：先加载的不会被后加载的覆盖,properties优先级高于yaml
从先到后
根目录config文件夹下的application.properties 和 application.yaml
根目录下的application.properties 和 application.yaml
src目录下resources目录下的config文件夹下的application.properties 和 application.yaml
src目录下resources目录下下的application.properties 和 application.yaml
项目外
jar包同目录的config文件夹下的application.properties 和 application.yaml
jar包同目录下的application.properties 和 application.yaml
当然也可以通过命令行的方式指定，这样的话是优先级最高的
</code></pre><h3 id="异常细化处理">异常细化处理</h3>
<pre tabindex="0"><code class="language-a" data-lang="a">SpringBoot 对 controller 层捕获全局异常并处理的方法
（@ControllerAdvice 和 @ExceptionHandler）
为了避免在controller中写太多的try-catch块，
只要定义一个全局异常处理类即可
类上用ControllerAdvice 注解标明这是一个全局异常处理配置类，
方法上用ExceptionHandler指定要处理的异常。
</code></pre><h1 id="spring-security">Spring Security</h1>
<h2 id="尚硅谷springsecurity框架教程-总结">尚硅谷SpringSecurity框架教程 总结</h2>
<pre tabindex="0"><code class="language-a" data-lang="a">官方文档
https://www.springcloud.cc/spring-security.html#overall-architecture
本质就是一堆过滤器
基于微服务的认证-简单案例
工程架构
1、common
service_base 工具类 [md5加密、统一返回结果]
spring_security 权限配置 [密码处理、退出处理器、token操作工具类、未授权统一处理]  [授权过滤 、认证过滤]  [核心配置类]
重写loadUserByUsername去查数据库返回信息认证。
2、infrastructure 
api_gateway 网关  
3、service
service_acl 权限管理微服务模块

过程
1、登录(用户名和密码)
2、redis存一份、同时基于用户信息生成jwt
3、token放到cookie，header放token
4、Spring Security 获取token获取用户名，拿着用户名从redis获取权限列表 [认证]
5、Spring Security给当前用户授权  [授权]
</code></pre><h2 id="spring-security-认证流程">Spring Security 认证流程</h2>
<p><img src="/images/Security_auth.png" alt="Markdowm Image"></p>
<h2 id="安全小知识">安全小知识</h2>
<h3 id="md5">MD5</h3>
<pre tabindex="0"><code class="language-a" data-lang="a">MD5加密是一种不可逆的编码方式，将明文编码只有再将明文MD5后才能比对。
</code></pre><h3 id="jwt">jwt</h3>
<pre tabindex="0"><code class="language-a" data-lang="a">JWT的本质就是一个字符串，它是将用户信息保存到一个Json字符串中，
然后进行编码后得到一个JWT token
并且这个JWT token带有签名信息，接收后可以校验是否被篡改，
所以可以用于在各方之间安全地将信息作为Json对象传输
1、在登录验证通过后，给用户生成一个对应的随机token(注意这个token不是指jwt，可以用uuid等算法生成)，
2、然后将这个token作为key的一部分，用户信息作为value存入Redis，并设置过期时间，
这个过期时间就是登录失效的时间 将第1步中生成的随机token作为JWT的payload生成JWT字符串返回给前端
3、前端之后每次请求都在请求头中的Authorization字段中携带JWT字符串
4、后端定义一个拦截器，每次收到前端请求时，都先从请求头中的Authorization字段中取出JWT字符串并进行验证，验证通过后解析出payload中的随机token，
然后再用这个随机token得到key，从Redis中获取用户信息，如果能获取到就说明用户已经登录

redis存jwt的理由可能是为了统一管理jwt，失效。
</code></pre><h3 id="jwt什么原理">jwt什么原理</h3>
<pre tabindex="0"><code class="language-a" data-lang="a">jwt什么原理
https://www.ruanyifeng.com/blog/2018/07/json_web_token-tutorial.html
https://www.cnblogs.com/throwable/p/14419015.html#%E4%BD%BF%E7%94%A8jwt%E6%9B%BE%E7%BB%8F%E9%81%87%E5%88%B0%E7%9A%84%E5%9D%91
https://segmentfault.com/a/1190000019414972
JWT 的原理是，服务器认证以后，生成一个 JSON 对象，发回给用户，就像下面这样。
注意要点
1、设置过期时间
2、同时失效重新生成导致cpu炸裂（加随机数时间）
3、不要放敏感信息（密码）
</code></pre><h3 id="csrf">csrf</h3>
<pre tabindex="0"><code class="language-a" data-lang="a">请求了敏感网站（银行）、会把重要的认证信息放在cookie里面，
然后又访问了欺诈网站，欺诈网站要求访问敏感网站，这样客户端就会
拿着cookie里面的认证信息访问敏感网站。从而达到攻击的目的。
防御方法:关键是加入一些不在cooike的值来验证,
[表单加伪随机数、tooken、验证码,验证 HTTP Referer 字段]
</code></pre><h1 id="mybatis">Mybatis</h1>
<h3 id="和的区别是什么">#{}和${}的区别是什么？</h3>
<pre tabindex="0"><code class="language-a" data-lang="a">#{}是预编译处理，${}是字符串替换。
Mybatis 在处理#{}时，会将 sql 中的#{}替换为?号，调用 PreparedStatement 的
set 方法来赋值；
Mybatis 在处理${}时，就是把${}替换成变量的值。
使用#{}可以有效的防止 SQL 注入，提高系统安全性。
</code></pre><h2 id="mybatis的优势">mybatis的优势</h2>
<pre tabindex="0"><code class="language-a" data-lang="a">https://juejin.cn/post/6908621952533921800
https://segmentfault.com/a/1190000022361169
优点
(1)基于sql,非常灵活
(2)与JDBC相比，减少了50%以上的代码量，消除了JDBC大量冗余的代码，不需要手动开关连接；
(3)很好的与各种数据库兼容
(4)能够与Spring很好的集成；
(5)提供映射标签，支持对象与数据库的ORM字段关系映射；提供对象关系映射标签，支持对象关系组件维护。
缺点
(1)依赖sql
(2)依赖数据库，数据库的移植性不高
</code></pre><h1 id="spring-cloud">Spring Cloud</h1>
<h2 id="gateway">gateway</h2>
<pre tabindex="0"><code class="language-a" data-lang="a">核心概念
1、路由=id+目标uri+一组断言+一组过滤器
2、断言 [匹配的规则]
3、过滤器  [global filter , gateway filter  局部和全局的做一个区分]

路由规则
1、path
2、querys
3、method
4、datetime
5、remoteAddr
6、header

动态路由：
1、自己根据服务名找ip端口号[半自动]
2、直接开启服务发现[全自动]

过滤器
网关过滤器、全局过滤器、自定义过滤器
限流算法：
1、计数器
2、漏桶算法
3、令牌桶
令牌桶算法能够在限制数据的平均传输速率的同时还允许某种程度的突发传输。
漏桶的话不允许突发传输。

限流规则
1、URI限流
2、参数限流
3、IP限流

Sentinel支持Spring cloud gateway
高可用网关
一个nginx加一个gateway集群。
</code></pre>
        </p>
    </div>
</div>

<aside class="post-toc">
    <nav id="toc">
        <nav id="TableOfContents">
  <ul>
    <li><a href="#quote">quote</a></li>
    <li><a href="#参考链接和资料">参考链接和资料</a></li>
    <li><a href="#spring基础知识">Spring基础知识</a>
      <ul>
        <li><a href="#aop和ioc">AOP和IOC</a></li>
        <li><a href="#spring-aop使用方式">Spring AOP使用方式</a></li>
        <li><a href="#spring的组件有哪些">Spring的组件有哪些？</a></li>
        <li><a href="#bean的生命周期">bean的生命周期</a></li>
        <li><a href="#循环依赖三级缓存">循环依赖（三级缓存）</a></li>
        <li><a href="#事务">事务</a></li>
        <li><a href="#spring中存在的设计模式">Spring中存在的设计模式</a></li>
        <li><a href="#interceptor和filter的区别">interceptor和filter的区别</a></li>
        <li><a href="#springboot">SpringBoot</a>
          <ul>
            <li><a href="#springbootapplication哪几部分组成">@SpringBootApplication哪几部分组成</a></li>
            <li><a href="#自动配置原理todo">自动配置原理(todo)</a></li>
            <li><a href="#springboot的配置文件优先级">SpringBoot的配置文件优先级？</a></li>
            <li><a href="#异常细化处理">异常细化处理</a></li>
          </ul>
        </li>
      </ul>
    </li>
    <li><a href="#spring-security">Spring Security</a>
      <ul>
        <li><a href="#尚硅谷springsecurity框架教程-总结">尚硅谷SpringSecurity框架教程 总结</a></li>
        <li><a href="#spring-security-认证流程">Spring Security 认证流程</a></li>
        <li><a href="#安全小知识">安全小知识</a>
          <ul>
            <li><a href="#md5">MD5</a></li>
            <li><a href="#jwt">jwt</a></li>
            <li><a href="#jwt什么原理">jwt什么原理</a></li>
            <li><a href="#csrf">csrf</a></li>
          </ul>
        </li>
      </ul>
    </li>
    <li><a href="#mybatis">Mybatis</a>
      <ul>
        <li>
          <ul>
            <li><a href="#和的区别是什么">#{}和${}的区别是什么？</a></li>
          </ul>
        </li>
        <li><a href="#mybatis的优势">mybatis的优势</a></li>
      </ul>
    </li>
    <li><a href="#spring-cloud">Spring Cloud</a>
      <ul>
        <li><a href="#gateway">gateway</a></li>
      </ul>
    </li>
  </ul>
</nav>
    </nav>
</aside>



    

        </main><footer class="footer">
    <span>&copy; 2022 lsy-dot</span>
    <span>
        Made with &#10084;&#65039; using <a target="_blank" href="https://github.com/526avijitgupta/gokarna">Gokarna</a>
    </span>
</footer>
</body>
</html>
